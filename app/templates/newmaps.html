{% extends "base.html" %}

<!-- Map -->
  {% block content %}
<div class="large-centered 
                  large-10 medium-centered medium-8 small-8 small-centered
                  columns">
  <script type="text/javascript">
    var map;
    $(document).ready(function(){
      map = new GMaps({
        el: 'map',
        lat: 39.9500,
        lng: -75.1667
      });
      $('#geocoding_form').submit(function(e){
        e.preventDefault();
        GMaps.geocode({
          address: $('#address').val().trim(),
          callback: function(results, status){
            if(status=='OK'){
              map.removeMarkers();
              var markers = [];
              var latlng = results[0].geometry.location;
              map.setCenter(latlng.lat(), latlng.lng());
              var zipCode = results[0].address_components[0].short_name;
                  var minLat = latlng.lat();
                  var maxLat = latlng.lat();
                  var minLng = latlng.lng();
                  var maxLng = latlng.lng();              
            $.getJSON($SCRIPT_ROOT + '/_map', {
          zip_code: zipCode
        },
            function(data) {
              for (var i = 0; i < data["addresses"].length; i++)
              {
                var newAddress = data["addresses"][i]["address"]["line1"] + ', ' + data["addresses"][i]["address"]["city"] + ', ' + data["addresses"][i]["address"]["state"] ;
                (function(){
                    var newTitle = data["addresses"][i]["name"];
                    var newDescription = newTitle + "<br>" + data["addresses"][i]["description"] + "<br>" 
                    + "Contact Information: " + data["addresses"][i]["phone_number"]["number"];
                    console.log(data["addresses"][i]["phone_number"])          
                    var newType = data["addresses"][i]["location_type"];
                if (newType == 'FARMERS_MARKET') { var image = "../static/img/mbb_yellow.png" }
                else if (newType == 'FOOD_CUPBOARD') { var image = "../static/img/mbb_green.png" }
                else if (newType == 'SENIOR_MEAL') { var image = "../static/img/mbb_blue.png" }
                else if (newType == 'SHARE') { var image = "../static/img/mbb_red.png" }
                else if (newType == 'SOUP_KITCHEN') { var image = "../static/img/mbb_orange.png" }
                else if (newType == 'WIC_OFFICE') { var image = "../static/img/mbb_purple.png" }
                else                   { var image = "../static/img/FPAC_LOGO.png"}
                GMaps.geocode({
                  address: newAddress,
                  callback: function(results, status) {
                    if (status == 'OK')
                    {
                      var newMarker = results[0].geometry.location; 
                      myLat = newMarker.lat();
                      myLng = newMarker.lng();
                      console.log(myLat);
                      console.log(myLng);
                      console.log(newTitle);
                      console.log(image);
                      markers.push({
                        lat : newMarker.lat(),
                        lng : newMarker.lng(),
                        title: newTitle,
                        icon : {url: image,
                                size: new google.maps.Size(50,50),
                                scaledSize: new google.maps.Size(20,25)},
                        infoWindow : { content: newDescription }
                      }); 
                     console.log(markers);
                     console.log(minLng);
                     console.log(maxLng);
                     console.log(minLat);
                     console.log(maxLat);
                    }
                    map.addMarkers(markers);      
                    map.fitZoom();  
                  }
                  }); }) ();
              }
           });
            }
          }
        });
      });                                
    });
    </script>
</div>

<body id = "map_p">
    <div class="row">
        <h1 class="page-header" id="map-header">Philly Food Finder</h1>
        <hr align="center">
    </div>
    <div class="row">
        <div class="large-centered large-10 medium-centered medium-8 small-8 small-centered columns content">
            <form method="post" id="geocoding_form">
                <div class="small-12 columns">
                    <label for="address">Zip Code:</label>
                    <input type="text" id="address" name="address" />
                </div>
                <div class="small-12 columns">
                    <input type="checkbox" id="map-filter-by-open-now"> Open now
                    <input type="checkbox" id="map-filter-by-families-and-children"> Families and children
                    <input type="checkbox" id="map-filter-by-seniors"> Seniors
                </div>
                <div class="small-12 columns search-buttons">
                    <input type="submit" class="button radius small" value="Search" id="map-search-button" />
                    <input type="submit" class="button radius small" value="Clear Filters" id="map-filter-button" />
                </div>
            </form>      
            <div id="map-container">
                <div id="map"></div>
            </div> 
            <div id="map-key">
                <div class="small-12 medium-4 columns pin-definition">
                    <img src="../static/img/mbb_yellow.png" alt="Yellow Pin"/>
                    Farmers' Market
                </div>
                <div class="small-12 medium-4 columns pin-definition">
                    <img src="../static/img/mbb_blue.png" alt="Blue Pin"/>
                    Senior Meal
                </div>
                <div class="small-12 medium-4 columns pin-definition">
                    <img src="../static/img/mbb_green.png" alt="Green Pin"/>
                    Food Cupboard
                </div>
                <div class="small-12 medium-4 columns pin-definition">
                    <img src="../static/img/mbb_red.png" alt="Red Pin"/>
                    SHARE Host Site
                </div>
                <div class="small-12 medium-4 columns pin-definition">
                    <img src="../static/img/mbb_orange.png" alt="Orange Pin"/>
                    Soup Kitchen
                </div>
                <div class="small-12 medium-4 columns pin-definition">
                    <img src="../static/img/mbb_purple.png" alt="Yellow Pin"/>
                    WIC Office
                </div>
            </div>
            <div id="footer-spacer">
            </div>
        </div>
    </div> 
</body>
{% endblock %}


<!-- FAQ -->
{% block content_faq %}

{% endblock %}